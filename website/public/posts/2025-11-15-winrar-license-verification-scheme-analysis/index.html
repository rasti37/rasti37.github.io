<!DOCTYPE html>
<html lang='en-us'>
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
	
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta property="og:title" content="Deep Dive into WinRAR License Verification Scheme">
	<meta name="twitter:title" content="Deep Dive into WinRAR License Verification Scheme">
	<meta name="description" content="In this post I deep dive into analyzing the license verification scheme of the popular freeware WinRAR.">
	<meta property="og:description" content="In this post I deep dive into analyzing the license verification scheme of the popular freeware WinRAR.">
	<meta name="twitter:description" content="In this post I deep dive into analyzing the license verification scheme of the popular freeware WinRAR.">
	<meta property="og:type" content="article">
	<meta property="og:url" content="http://localhost:1313/posts/2025-11-15-winrar-license-verification-scheme-analysis/">
	<meta property="og:site_name" content="rasti&#39;s knowledge cave">
	<meta name="twitter:card" content="summary_large_image">
	<link rel="icon" type="image/x-icon" href="/thumb.png">
	<style type=text/css>body{font-family:monospace;}</style>
	<title>Deep Dive into WinRAR License Verification Scheme</title>
	
	
	<link rel="stylesheet" href="/css/style.css">
	
	
</head>
<body>
	<header>
	############################<br>
	## <a href="http://localhost:1313/" class='header-footer-anchor'>rasti&#39;s knowledge cave</a> ##<br>
	############################
	<div style="float: right;">gatekeeping is for the weak</div><br>
	<nav>
		<a href="/" class='header-footer-anchor'><b>Start</b></a> Â·
		
		
		
		<a href="/posts/" class='header-footer-anchor'><b>Posts</b></a> Â· 
		
		<a href="/categories/" class='header-footer-anchor'><b>Categories</b></a> Â· 
		
		<a href="/tags/" class='header-footer-anchor'><b>Tags</b></a>
		
	</nav>
	
	
</header>
	
<main>
	<article>
		<h1>Deep Dive into WinRAR License Verification Scheme</h1>
		<small>Created at: 15/11/2025, 22:52:50</small><br>
		
		
		<br>.:
		
		
		<a href="/tags/real-world" class='header-footer-anchor'>#real-world</a>, 
		
		<a href="/tags/sage" class='header-footer-anchor'>#sage</a>, 
		
		<a href="/tags/reverse-engineering" class='header-footer-anchor'>#reverse-engineering</a>, 
		
		<a href="/tags/crypto" class='header-footer-anchor'>#crypto</a>
		:.
		<div>
			<div style='cursor: pointer; border-radius: 3px; border:1px solid #888; padding: 7px; margin: 1.3em 0 1.3em 0;'>
    <details>
        <summary>Table of Contents</summary>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#signature-scheme-overview">Signature Scheme Overview</a>
      <ul>
        <li><a href="#signature-generation-algorithm-overview">Signature Generation Algorithm Overview</a></li>
        <li><a href="#signature-verification-algorithm-overview">Signature Verification Algorithm Overview</a>
          <ul>
            <li><a href="#proof-of-correctness">Proof of Correctness</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#mapping-source-code-to-decompiled-code">Mapping source code to decompiled code</a></li>
    <li><a href="#winrar-signature-scheme-component-analysis">WinRAR Signature Scheme Component Analysis</a>
      <ul>
        <li><a href="#analysis-of-the-hash-function-h">Analysis of the hash function $H$</a></li>
        <li><a href="#analyzing-the-vlong-type">Analyzing the <code>vlong</code> type</a></li>
        <li><a href="#analysis-of-the-prng">Analysis of the PRNG</a>
          <ul>
            <li><a href="#how-is-the-prng-seed-set">How is the PRNG seed set</a></li>
            <li><a href="#how-are-random-integers-generated">How are random integers generated</a></li>
          </ul>
        </li>
        <li><a href="#defining-the-curve-in-sagemath">Defining the curve in SageMath</a>
          <ul>
            <li><a href="#analyzing-the-pegwit-data-types">Analyzing the Pegwit data types</a></li>
            <li><a href="#first-try-failed">First try (failed)</a></li>
            <li><a href="#second-try">Second try</a></li>
            <li><a href="#final-boss">Final Boss</a></li>
          </ul>
        </li>
        <li><a href="#implementation-sanity-check">Implementation Sanity Check</a></li>
      </ul>
    </li>
    <li><a href="#bonus">BONUS</a></li>
  </ul>
</nav>
    </details>
</div>
<h1 id="introduction">Introduction</h1>
<p>Upon reverse engineering WinRAR to understand its internal workings and how the license key validation works, I discovered that all versions utilise a pretty ancient library for performing public key encryption and authentication â€” namely <a href="https://web.archive.org/web/19990117082016/http://ds.dial.pipex.com:80/george.barwood/v8/pegwit.htm" target="_blank" rel="noopener"><code>Pegwit (v8)</code></a>. Thankfully, its source code has now been uploaded to <a href="https://github.com/t-crest/patmos-benchmarks/tree/master/Mediabench/pegwit/src" target="_blank" rel="noopener">Github</a> so no need for the reader to hassle with a local copy.</p>
<p>Pegwit implements Elliptic Curve Cryptography (ECC) over finite fields and uses a variant of the Nyberg-Rueppel signature scheme for signing and verifying data. During my reversing, I wasn&rsquo;t able to find any SageMath implementation (or python at all) of the WinRAR signature scheme so this is where the fun began. By the way, this post was my main source of inspiration and motivation for making my previous post about <a href="https://rasti37.github.io/posts/2025-03-07-computing-inverse-ring-homomorphisms-diy/" target="_blank" rel="noopener">Inverse Ring Homomorphisms</a>. We&rsquo;ll see how this is related shortly.</p>
<p>In this post, we will dive into how WinRAR&rsquo;s signature scheme works and we will re-implement it in SageMath. For this project, I worked with WinRAR 3.60 and the binary&rsquo;s sha256 checksum is: <code>8f0be63e34e412f339b625529361ac1576be5e84b4571c1cfafad9c6f4675645</code>.</p>
<h1 id="signature-scheme-overview">Signature Scheme Overview</h1>
<p>Let $E$ be an elliptic curve with the following equation:</p>
<p>$$
E : y^2 + xy = x^3 + 161
$$</p>
<p>defined over the finite field $K = \text{GF}((2^{15})^{17})$. Using SageMath, we find the order of $E$ (source: Trust Me Bro):</p>
<p>$$q = 57896044618658097711785492504343953927113495037180187459668330685293304062220$$</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>sage: factor(<span style="color:#ae81ff">57896044618658097711785492504343953927113495037180187459668330685293304062220</span>)
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span><span style="color:#f92672">^</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">541</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1783611972232227286253403958852247502375646797202100661111162374777982257</span>
</span></span></code></pre></div><p>It turns out that, the ECC arithmetic for WinRAR is done in the $n$-torsion subgroup of prime order:</p>
<p>$$n = 1783611972232227286253403958852247502375646797202100661111162374777982257$$</p>
<p>An $n$-torsion subgroup is simply a subgroup of the group $E(K)$ that contains all the points of order $n$.</p>
<p>Let&rsquo;s define some notation first.</p>
<ul>
<li>$M$ &ndash; the message to be signed and $h = H(M)$ the hash digest of $M$. More on the internals of $H$ later.</li>
<li>$x$ &ndash; the private key used to sign $M$.</li>
<li>$(r, s)$ &ndash; the signature of $M$.</li>
<li>$G$ &ndash; a fixed point of order $n$ defined in Pegwit.</li>
<li>$P$ &ndash; the public key used to verify $(r,s)$ along with $M$. $P$ is computed as $x \cdot G$.</li>
<li>$[A]_x$ &ndash; the x-coordinate of the point $A$.</li>
</ul>
<h2 id="signature-generation-algorithm-overview">Signature Generation Algorithm Overview</h2>
<p>For each signature, a unique, $240$-bit nonce $k$ is generated and the signature is computed as:</p>
<p>$$\quad\quad\quad\quad\ \ r = [k \cdot G]_x + h \pmod n\quad\quad(1)\\
s = k - r \cdot x \pmod n$$
Final signature: $(r,s)$</p>
<h2 id="signature-verification-algorithm-overview">Signature Verification Algorithm Overview</h2>
<p>Given a signature $(r,s)$, the hash digest $h = H(M)$ and the public key $P = x \cdot G$, the message $M$ is verified if and only if:</p>
<p>$$r - [s \cdot G + r \cdot P]_x \stackrel{?}{=} h$$</p>
<h3 id="proof-of-correctness">Proof of Correctness</h3>
<p>Why does this equation verify the signature? Working with the left-hand side, our goal is to end up with $h$. That would mean that the equation holds.</p>
<p>First, let&rsquo;s substitute $P$ with $x \cdot G$:</p>
<p>$$r - [s \cdot G + r \cdot x \cdot G]_x = r - [(s + r \cdot x) \cdot G]_x$$</p>
<p>Then, we substitute $s$:</p>
<p>$$r - [(k - r \cdot x + r \cdot x) \cdot G]_x = r - [k \cdot G]_x$$</p>
<p>Looking at how $r$ is defined in (1), we know that:</p>
<p>$$h = r - [k \cdot G]_x$$</p>
<p>This concludes the proof.</p>
<p>At this point, we have enough information to write a high-level pseudocode of this signature scheme in SageMath.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x1026dd85081b82314691ced9bbec30547840e4bf72d8b5e0d258442bbcd31</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sign</span>(privkey, M):
</span></span><span style="display:flex;"><span>    k <span style="color:#f92672">=</span> get_nonce()
</span></span><span style="display:flex;"><span>    h <span style="color:#f92672">=</span> hash_message(M)
</span></span><span style="display:flex;"><span>    P <span style="color:#f92672">=</span> G <span style="color:#f92672">*</span> k
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> (int(P<span style="color:#f92672">.</span>x()) <span style="color:#f92672">+</span> h) <span style="color:#f92672">%</span> n
</span></span><span style="display:flex;"><span>    s <span style="color:#f92672">=</span> (k <span style="color:#f92672">-</span> privkey <span style="color:#f92672">*</span> r) <span style="color:#f92672">%</span> n
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (r, s)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">verify</span>(pubkey, M, sig):
</span></span><span style="display:flex;"><span>    h <span style="color:#f92672">=</span> hash_message(M)
</span></span><span style="display:flex;"><span>    r, s <span style="color:#f92672">=</span> sig
</span></span><span style="display:flex;"><span>    t1 <span style="color:#f92672">=</span> G <span style="color:#f92672">*</span> s
</span></span><span style="display:flex;"><span>    t2 <span style="color:#f92672">=</span> pubkey <span style="color:#f92672">*</span> r
</span></span><span style="display:flex;"><span>    t1 <span style="color:#f92672">=</span> (t1 <span style="color:#f92672">+</span> t2)<span style="color:#f92672">.</span>x() <span style="color:#f92672">%</span> n
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> h <span style="color:#f92672">==</span> r <span style="color:#f92672">-</span> t1<span style="color:#f92672">.</span>x()
</span></span></code></pre></div><p>But this is far from complete and accurate. Well &hellip; to be 100% honest with you, the final version of the class will look like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NybergRueppelScheme</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, seed):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>ecc <span style="color:#f92672">=</span> ECC()
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>seed <span style="color:#f92672">=</span> seed
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sign</span>(self, msg: bytes):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>prng <span style="color:#f92672">=</span> PRNG(self<span style="color:#f92672">.</span>seed)
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>prng<span style="color:#f92672">.</span>gen_random()
</span></span><span style="display:flex;"><span>        h <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>prng<span style="color:#f92672">.</span>hash_data(msg)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>            k <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>prng<span style="color:#f92672">.</span>gen_random()
</span></span><span style="display:flex;"><span>            r, s <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>sign_internal(x, k, h)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> r <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">and</span> s <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (r, s)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sign_internal</span>(self, x, k, h):
</span></span><span style="display:flex;"><span>        P <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>ecc<span style="color:#f92672">.</span>G <span style="color:#f92672">*</span> k
</span></span><span style="display:flex;"><span>        Px <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>ecc<span style="color:#f92672">.</span>gfPoint2Int(P<span style="color:#f92672">.</span>x())
</span></span><span style="display:flex;"><span>        r <span style="color:#f92672">=</span> (int(Px) <span style="color:#f92672">+</span> h) <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>ecc<span style="color:#f92672">.</span>n
</span></span><span style="display:flex;"><span>        s <span style="color:#f92672">=</span> (k <span style="color:#f92672">-</span> x <span style="color:#f92672">*</span> r) <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>ecc<span style="color:#f92672">.</span>n
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (r, s)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">verify</span>(self, pubkey, msg, sig):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>prng <span style="color:#f92672">=</span> PRNG(self<span style="color:#f92672">.</span>seed)
</span></span><span style="display:flex;"><span>        h <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>prng<span style="color:#f92672">.</span>hash_data(msg)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>verify_internal(pubkey, h, sig)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">verify_internal</span>(self, pubkey, h, sig):
</span></span><span style="display:flex;"><span>        r, s <span style="color:#f92672">=</span> sig
</span></span><span style="display:flex;"><span>        t1 <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>ecc<span style="color:#f92672">.</span>G <span style="color:#f92672">*</span> s
</span></span><span style="display:flex;"><span>        t2 <span style="color:#f92672">=</span> pubkey <span style="color:#f92672">*</span> r
</span></span><span style="display:flex;"><span>        t1 <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>ecc<span style="color:#f92672">.</span>gfPoint2Int((t1 <span style="color:#f92672">+</span> t2)<span style="color:#f92672">.</span>x()) <span style="color:#f92672">%</span> self<span style="color:#f92672">.</span>ecc<span style="color:#f92672">.</span>n
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> h <span style="color:#f92672">==</span> r <span style="color:#f92672">-</span> self<span style="color:#f92672">.</span>ecc<span style="color:#f92672">.</span>gfPoint2Int(t1<span style="color:#f92672">.</span>x())
</span></span></code></pre></div><p>What is <code>gfPoint2Int</code>? How is the message actually hashed? What is this PRNG? How is it seeded? Hang in there â€” we still have a long way to go and I will explain everything in detail.</p>
<h1 id="mapping-source-code-to-decompiled-code">Mapping source code to decompiled code</h1>
<p>As aforementioned, thankfully, there is no need for hardcore reverse engineering, since most of the scheme&rsquo;s logic and implementation derive directly from Pegwit, which is open-source. For example, with a bit of targeted reverse engineering and audit of Pegwit&rsquo;s codebase, one can map Pegwit elements to their counterparts in the WinRAR decompilation through a bit of debugging and structural similarities. Some of the mapped components are shown below:</p>
<table>
  <thead>
      <tr>
          <th>Virtual Address</th>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0x406CB8</td>
          <td><code>cpVerify</code></td>
          <td>Method</td>
          <td>Internal method for signature verification using $P$</td>
      </tr>
      <tr>
          <td>0x4A09D4</td>
          <td>$(G_x, G_y)$</td>
          <td>Array</td>
          <td>$(x,y)$ coordinates of the base point $G$</td>
      </tr>
      <tr>
          <td>0x4A0988</td>
          <td>Prime order $n$</td>
          <td>Array</td>
          <td>The prime order of the subgroup generated by $G$</td>
      </tr>
      <tr>
          <td>0x407F6C</td>
          <td><code>prng_hash_data</code></td>
          <td>Method</td>
          <td>Internal method for computing the raw data hash $h$</td>
      </tr>
      <tr>
          <td>0x407E7C</td>
          <td><code>prng_init</code></td>
          <td>Method</td>
          <td>Internal method for initializing WinRAR&rsquo;s PRNG</td>
      </tr>
      <tr>
          <td>0x4A0B67</td>
          <td>$P_x$</td>
          <td>String</td>
          <td>The $x$-coordinate of the public key point $P$</td>
      </tr>
      <tr>
          <td>0x406C08</td>
          <td><code>cpSign</code></td>
          <td>Method</td>
          <td>Internal method for signing data using $x$</td>
      </tr>
  </tbody>
</table>
<p>Moreover, having determined that <code>0x406C08</code> is <code>cpSign</code>, one can proceed to rename all of its callee functions according to Pegwit source. This process ultimately yields a decompilation nearly identical to the original implementation:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#66d9ef">__fastcall</span> <span style="color:#a6e22e">cpSign</span>(<span style="color:#66d9ef">int</span> vlPrivateKey, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>k, <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>vlMac, cpPair <span style="color:#f92672">*</span>sig)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> tmp[<span style="color:#ae81ff">19</span>]; <span style="color:#75715e">// [esp+Ch] [ebp-170h] BYREF
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  ecPoint P; <span style="color:#75715e">// [esp+58h] [ebp-124h] BYREF
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ecCopy</span>(<span style="color:#f92672">&amp;</span>P, <span style="color:#f92672">&amp;</span>BasePointG);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ecMultiply</span>(<span style="color:#f92672">&amp;</span>P, k);                            <span style="color:#75715e">// Q = P*k
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">gfPack</span>(<span style="color:#f92672">&amp;</span>P, sig);                              <span style="color:#75715e">// r = Q.x
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">vlAdd</span>(sig, vlMac);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">vlRemainder</span>(sig, PrimeOrder);                 <span style="color:#75715e">// r = (Qx + mac) % q
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> ( <span style="color:#f92672">*</span>sig<span style="color:#f92672">-&gt;</span>r )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">vlMulMod</span>(tmp, vlPrivateKey, sig, PrimeOrder);<span style="color:#75715e">// tmp = (x * r) % n
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">vlCopy</span>(sig<span style="color:#f92672">-&gt;</span>s, k);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">vlGreater</span>(tmp, sig<span style="color:#f92672">-&gt;</span>s) )
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">vlAdd</span>(sig<span style="color:#f92672">-&gt;</span>s, PrimeOrder);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">vlSubtract</span>(sig<span style="color:#f92672">-&gt;</span>s, tmp);                    <span style="color:#75715e">// s = k - x * r
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>where <code>cpPair</code>, <code>ecPoint</code> are helper structs that enhance readibility:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> cpPair {
</span></span><span style="display:flex;"><span>    _BYTE r[<span style="color:#ae81ff">76</span>];
</span></span><span style="display:flex;"><span>    _BYTE s[<span style="color:#ae81ff">76</span>];
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> ecPoint {
</span></span><span style="display:flex;"><span>    _WORD x[<span style="color:#ae81ff">72</span>];
</span></span><span style="display:flex;"><span>    _WORD y[<span style="color:#ae81ff">72</span>];
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><h1 id="winrar-signature-scheme-component-analysis">WinRAR Signature Scheme Component Analysis</h1>
<p>Having established some decent background knowledge, let&rsquo;s dive deep into the WinRAR internals.</p>
<h2 id="analysis-of-the-hash-function-h">Analysis of the hash function $H$</h2>
<p>Let&rsquo;s begin by analyzing how the raw data are hashed. In other words, how $h = H(M)$ is computed.</p>
<p>For this purpose, we are interested in <code>prng_hash_data</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">prng_hash_data</span>(prng <span style="color:#f92672">*</span>p, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>data, <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> data_length)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    hash_context HashContext[<span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> i[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">hash_initial</span>(HashContext);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">hash_initial</span>(HashContext <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">hash_process</span>(<span style="color:#f92672">&amp;</span>HashContext[<span style="color:#f92672">*</span>i], i, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">hash_process</span>(HashContext, (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span><span style="color:#f92672">*</span>) data, data_length);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">hash_process</span>(HashContext<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span><span style="color:#f92672">*</span>) data, data_length);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">hash_final</span>(HashContext, p<span style="color:#f92672">-&gt;</span>state <span style="color:#f92672">+</span> <span style="color:#ae81ff">6</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">hash_final</span>(HashContext, p<span style="color:#f92672">-&gt;</span>state <span style="color:#f92672">+</span> <span style="color:#ae81ff">11</span>);
</span></span><span style="display:flex;"><span>    p<span style="color:#f92672">-&gt;</span>count <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>where <code>hash_initial</code> is implemented as:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">hash_initial</span>(hash_context<span style="color:#f92672">*</span> context)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/* SHA1 initialization constants */</span>
</span></span><span style="display:flex;"><span>    context<span style="color:#f92672">-&gt;</span>state[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x67452301</span>;
</span></span><span style="display:flex;"><span>    context<span style="color:#f92672">-&gt;</span>state[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xEFCDAB89</span>;
</span></span><span style="display:flex;"><span>    context<span style="color:#f92672">-&gt;</span>state[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x98BADCFE</span>;
</span></span><span style="display:flex;"><span>    context<span style="color:#f92672">-&gt;</span>state[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x10325476</span>;
</span></span><span style="display:flex;"><span>    context<span style="color:#f92672">-&gt;</span>state[<span style="color:#ae81ff">4</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xC3D2E1F0</span>;
</span></span><span style="display:flex;"><span>    context<span style="color:#f92672">-&gt;</span>count[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> context<span style="color:#f92672">-&gt;</span>count[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This strongly indicates that the backbone hashing is done by the SHA1 hash function. Note that even if the comment was missing, researching any constant, such as <code>0xC3D2E1F0</code>, would fetch results related to SHA-1.</p>
<p>For completeness, I will also copy/paste from the decompiler (address: <code>0x408235</code>), a code snippet where <code>prng_hash_data</code> is called:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ( a3 )
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">prng_set_mac</span>(<span style="color:#f92672">&amp;</span>prng, a3, <span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">prng_hash_data</span>(<span style="color:#f92672">&amp;</span>prng, Data, DataSize, <span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">hash_to_vlong</span>(<span style="color:#f92672">&amp;</span>prng.state[<span style="color:#ae81ff">6</span>], GeneratedMAC);
</span></span></code></pre></div><p>For our purposes, consider <code>a3</code> always equal to $0$. This can be derived by looking at the arguments of the function <code>0x4081F0</code>. Thus, this can be reduced to:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#a6e22e">prng_hash_data</span>(<span style="color:#f92672">&amp;</span>prng, Data, DataSize, <span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">hash_to_vlong</span>(<span style="color:#f92672">&amp;</span>prng.state[<span style="color:#ae81ff">6</span>], GeneratedMAC);
</span></span></code></pre></div><p>For now, don&rsquo;t worry about <code>hash_to_vlong</code>, treat it as a black-box that converts some data (first argument) to an integer that can be used mathematically for signing/verification operations (second argument). We will define such an integer as <code>vlong</code>.</p>
<p>The <code>prng</code> struct is defined as:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> word32;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> <span style="color:#75715e">/* Whole structure will be hashed */</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">unsigned</span> count;        <span style="color:#75715e">/* Count of words */</span>
</span></span><span style="display:flex;"><span>  word32 state[<span style="color:#ae81ff">17</span>];   <span style="color:#75715e">/* Used to crank prng */</span>
</span></span><span style="display:flex;"><span>} prng;
</span></span></code></pre></div><p>It should be obvious until now that the PRNG and the data hashing are closely related. The PRNG state consists of 17 dwords and the final hash $h = H(M)$ is derived from the PRNG as follows:</p>
<img src="prng-state-hash.png" style="width:80%" />
<p>Now we have everything we know to define mathematically how the final hash is computed. The call to <code>hash_process</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#a6e22e">hash_process</span>(HashContext, (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span><span style="color:#f92672">*</span>) data, data_length);
</span></span></code></pre></div><p>hashes our raw data and the final hash overwrites the state indices $[6,\ \cdots,\ 10]$. This is because a SHA-1 hash is $5 \cdot 4 = 20$ bytes long, corresponding to $5$ dwords.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#a6e22e">hash_final</span>(HashContext, p<span style="color:#f92672">-&gt;</span>state <span style="color:#f92672">+</span> <span style="color:#ae81ff">6</span>);
</span></span></code></pre></div><p>Here comes the tricky part. There appears to be a discrepancy between Pegwit&rsquo;s source and WinRAR&rsquo;s decompilation, which initially confused me and made it difficult for me to grasp what was going on. Just like that, I ended up spending several hours debugging in x64dbgðŸ™‚. In hindsight, this was probably a static-analysis skill issue on my part as I don&rsquo;t believe that the library itself is buggy â€” but hey, when static analysis fails, you gain more debugging experience (and lose a bit of hair) which is always really fun!</p>
<p>It turns out that shit happens with the first call to <code>hash_process</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#f92672">*</span>i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">hash_process</span>(<span style="color:#f92672">&amp;</span>HashContext[<span style="color:#f92672">*</span>i], i, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">hash_process</span>(HashContext<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span><span style="color:#f92672">*</span>) data, data_length);
</span></span></code></pre></div><p>These calls produce the fixed (magic) hash: <code>438dfd0f7c3ce3b4d11b465346a5270f0dd95010</code>, which corresponds to an empty byte-string input. This digest overwrites the state indices $[11,\ \dots,\ 15]$.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#a6e22e">hash_final</span>(HashContext, p<span style="color:#f92672">-&gt;</span>state <span style="color:#f92672">+</span> <span style="color:#ae81ff">11</span>);
</span></span></code></pre></div><p>(also check this <a href="https://github.com/micropython/micropython/issues/4119" target="_blank" rel="noopener">issue</a> which explains more about this magic hash).</p>
<p>Finally, as we mentioned already, the final hash is obtained by converting $[S_6,\ \dots,\ S_{13}]$ to a <code>vlong</code> integer.</p>
<p>The hashing process can be summarized with the following code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> hashlib <span style="color:#f92672">import</span> sha1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">H</span>(m):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> sha1(m)<span style="color:#f92672">.</span>digest()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">dwordize</span>(b: bytes) <span style="color:#f92672">-&gt;</span> list:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [int<span style="color:#f92672">.</span>from_bytes(b[i:i<span style="color:#f92672">+</span><span style="color:#ae81ff">4</span>], byteorder<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;big&#39;</span>) <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, len(b), <span style="color:#ae81ff">4</span>)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">vlToInteger</span>(vl):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> Integer(vl[<span style="color:#ae81ff">1</span>:], base<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span><span style="color:#f92672">^</span><span style="color:#ae81ff">16</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">hashToVlPoint</span>(h : list):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [<span style="color:#ae81ff">0x0f</span>] <span style="color:#f92672">+</span> [x <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">8</span>) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> [h[i] <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xffff</span>, h[i] <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">16</span>]][:<span style="color:#ae81ff">0x0f</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">hash_data</span>(self, data):
</span></span><span style="display:flex;"><span>    h1 <span style="color:#f92672">=</span> H(data)
</span></span><span style="display:flex;"><span>    h2 <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(<span style="color:#e6db74">&#39;0ffd8d43b4e33c7c53461bd10f27a5461050d90d&#39;</span>)  <span style="color:#75715e"># zero-length input hash (?)</span>
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>state[<span style="color:#ae81ff">0x06</span>:] <span style="color:#f92672">=</span> dwordize(h1)
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>state[<span style="color:#ae81ff">0x0b</span>:] <span style="color:#f92672">=</span> dwordize(h2)
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>count <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> vlToInteger(hashToVlPoint(self<span style="color:#f92672">.</span>state[<span style="color:#ae81ff">6</span>:<span style="color:#ae81ff">14</span>]))
</span></span></code></pre></div><p>Dang! What the heck are these <code>hashToVlPoint</code> and <code>vlToInteger</code> functions? I will explain shortly&hellip;</p>
<h2 id="analyzing-the-vlong-type">Analyzing the <code>vlong</code> type</h2>
<p>In the context of the Pegwit library, <code>vlong</code> is an array with the following form:</p>
<p>$$[l,\ v_1,\ \ \cdots,\ \ v_l]$$</p>
<p>where $v_i$ is a $16$-bit integer. In the WinRAR context, $l = 15$, which results in an array of fifteen $16$-bit integers. Pegwit performs arithmetic directly on integers of this form, as there is no natural way to work with such big integers in C; don&rsquo;t forget that standard integer arithmetic is limited to $64$ bits.</p>
<p>But why $l = 15$ ? Recall the prime order $n$. Let&rsquo;s compute its bit length:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> n <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x1026dd85081b82314691ced9bbec30547840e4bf72d8b5e0d258442bbcd31</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> n<span style="color:#f92672">.</span>bit_length()
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">241</span>
</span></span></code></pre></div><p>It is no coincidence that combining fifteen $16$-bit integers yields a $15 \cdot 16 = 240$-bit integer â€” which strongly indicates that this representation exists precisely because the scheme performs all computations modulo $n$.</p>
<p>Let&rsquo;s take a look at <code>hash_to_vlong</code> (<code>vlPoint</code> is synonym to <code>vlong</code>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> word16 vlPoint [VL_UNITS <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">hash_to_vlong</span>(word32<span style="color:#f92672">*</span> mac, vlPoint V)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">unsigned</span> i;
</span></span><span style="display:flex;"><span>    V[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>; <span style="color:#75715e">/* 240 bits */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>; i<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">8</span>; i<span style="color:#f92672">+=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        word32 x <span style="color:#f92672">=</span> mac[i];
</span></span><span style="display:flex;"><span>        V[i<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (word16) x;
</span></span><span style="display:flex;"><span>        V[i<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span><span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> (word16) (x<span style="color:#f92672">&gt;&gt;</span><span style="color:#ae81ff">16</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>It basically sets $V_0 = l = 15$ and then iterates over each of the $8$ dwords. For the $i$-th dword, it stores its $16$ LSB to $V_{2i+1}$ and its $16$ MSB to $V_{2i+2}$. We can implement this as:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">hash_to_vlong</span>(h : list):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [<span style="color:#ae81ff">0x0f</span>] <span style="color:#f92672">+</span> [x <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">8</span>) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> [h[i] <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xffff</span>, h[i] <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">16</span>]][:<span style="color:#ae81ff">0x0f</span>]
</span></span></code></pre></div><p>This concludes our Python implementation of WinRAR&rsquo;s data hashing process!</p>
<h2 id="analysis-of-the-prng">Analysis of the PRNG</h2>
<p>Let&rsquo;s define a base class for the PRNG.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PRNG</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, seed):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>state <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span> <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">17</span>)]   <span style="color:#75715e"># create memory for 1+16 dwords</span>
</span></span></code></pre></div><p>The following questions are raised regarding the PRNG:</p>
<ol>
<li>What does the internal state look like?</li>
<li>How the seed is set?</li>
<li>How is the next output generated?</li>
</ol>
<p>We already answered the first question; the state is an array of $1 + 16$ dwords.</p>
<p>For the second question, we take a look at the virtual address <code>0x4081F0</code> in our disassembler of choice. This is a wrapper method for signing the data and it looks like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#66d9ef">__fastcall</span> <span style="color:#a6e22e">ecc_sign_data_internal</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>Data, <span style="color:#66d9ef">int</span> DataSize, <span style="color:#66d9ef">int</span> PrecomputedMAC, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>Seed, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>Buffer)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// [COLLAPSED LOCAL DECLARATIONS. PRESS NUMPAD &#34;+&#34; TO EXPAND]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">prng_init</span>(<span style="color:#f92672">&amp;</span>prng);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">prng_set_secret</span>(<span style="color:#f92672">&amp;</span>prng, Seed);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">prng_generate_random_vlong</span>(<span style="color:#f92672">&amp;</span>prng, vlPrivateKey);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( PrecomputedMAC )
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">prng_set_mac</span>(<span style="color:#f92672">&amp;</span>prng, PrecomputedMAC, <span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">prng_hash_data</span>(<span style="color:#f92672">&amp;</span>prng, Data, DataSize, <span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">hash_to_vlong</span>(<span style="color:#f92672">&amp;</span>prng.state[<span style="color:#ae81ff">6</span>], GeneratedMAC);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gfInit</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">prng_generate_random_vlong</span>(<span style="color:#f92672">&amp;</span>prng, k);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">cpSign</span>(vlPrivateKey, k, GeneratedMAC, <span style="color:#f92672">&amp;</span>sig);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> ( <span style="color:#f92672">!*</span>sig.r );
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">put_vlong</span>(sig.s, s);
</span></span><span style="display:flex;"><span>    v7 <span style="color:#f92672">=</span> <span style="color:#a6e22e">strlen</span>(s);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">sprintf</span>(Buffer, <span style="color:#e6db74">&#34;%02.2d&#34;</span>, v7);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">strcpy</span>(Buffer <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>, s);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">put_vlong</span>(<span style="color:#f92672">&amp;</span>sig, <span style="color:#f92672">&amp;</span>Buffer[v7 <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gfQuit</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">prng_init</span>(<span style="color:#f92672">&amp;</span>prng);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">vlClear</span>(vlPrivateKey);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">vlClear</span>(k);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>By following the cross-references of <code>ecc_sign_data_internal</code> in IDA, one can see that the <code>Seed</code> variable is a hex string sourced from the <code>rarreg.key</code> license file.</p>
<h3 id="how-is-the-prng-seed-set">How is the PRNG seed set</h3>
<p><code>prng_set_secret</code> and <code>prng_generate_random_vlong</code> are the methods of interest. Let&rsquo;s begin with the former. It receives the seed and sets the internal state accordingly.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">prng_set_secret</span>(prng <span style="color:#f92672">*</span>p, <span style="color:#66d9ef">char</span><span style="color:#f92672">*</span> seed)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    hash_context HashContext;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">hash_initial</span>(<span style="color:#f92672">&amp;</span>HashContext);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">hash_process</span>(<span style="color:#f92672">&amp;</span>HashContext, (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span><span style="color:#f92672">*</span>)seed, <span style="color:#a6e22e">strlen</span>((<span style="color:#66d9ef">char</span><span style="color:#f92672">*</span>)seed));
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">hash_final</span>(<span style="color:#f92672">&amp;</span>HashContext, p<span style="color:#f92672">-&gt;</span>state<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    p<span style="color:#f92672">-&gt;</span>count <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>It&rsquo;s a pretty self-explanatory function, it hashes the seed with SHA-1 and overwrites $S_1,\ \dots,\ S_5$ with the output hash. Here is the same code transpiled in python:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">set_secret</span>(self, seed):
</span></span><span style="display:flex;"><span>    h <span style="color:#f92672">=</span> H(seed<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>state[<span style="color:#ae81ff">1</span>:len(h)<span style="color:#f92672">//</span><span style="color:#ae81ff">4</span>] <span style="color:#f92672">=</span> dwordize(h)
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>count <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>
</span></span></code></pre></div><h3 id="how-are-random-integers-generated">How are random integers generated</h3>
<p>As the name implies, the corresponding function for this is <code>prng_generate_random_vlong</code>. Its virtual address is <code>0x4080B4</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#66d9ef">__fastcall</span> <span style="color:#a6e22e">prng_generate_random_vlong</span>(prng <span style="color:#f92672">*</span>a1, _DWORD <span style="color:#f92672">*</span>out)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> i; <span style="color:#75715e">// ebx
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">*</span>out <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> ( i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">16</span>; <span style="color:#f92672">++</span>i )
</span></span><span style="display:flex;"><span>    out[i] <span style="color:#f92672">=</span> <span style="color:#a6e22e">prng_next</span>(a1);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Ah! We identify the <code>vlong</code> format. The first element of the array is always the number of 2-byte words that follow. Each word is set to a random value returned from <code>prng_next</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#66d9ef">__fastcall</span> <span style="color:#a6e22e">prng_next</span>(prng <span style="color:#f92672">*</span>a1)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// [COLLAPSED LOCAL DECLARATIONS. PRESS NUMPAD &#34;+&#34; TO EXPAND]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">++*</span>a1<span style="color:#f92672">-&gt;</span>state;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> ( i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> a1<span style="color:#f92672">-&gt;</span>count; <span style="color:#f92672">++</span>i )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> ( j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span>; <span style="color:#f92672">++</span>j )
</span></span><span style="display:flex;"><span>      buffer[<span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> j] <span style="color:#f92672">=</span> <span style="color:#f92672">*&amp;</span>a1<span style="color:#f92672">-&gt;</span>state[<span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> i] <span style="color:#f92672">&gt;&gt;</span> (<span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> j);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">SHA1_init</span>(<span style="color:#f92672">&amp;</span>hash_ctxt);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">SHA1_update</span>(hash_ctxt.state, buffer, <span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> a1<span style="color:#f92672">-&gt;</span>count, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">SHA1_hash</span>(hash_ctxt.state, res, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">memset</span>(buffer, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">sizeof</span>(buffer));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">LOWORD</span>(res[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Again, straight-forward. Explaining this method in more detail would only create unnecessary confusion, so let&rsquo;s simply transpile it to Python.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gen_random</span>(self):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> vlToInteger([<span style="color:#ae81ff">0x0f</span>] <span style="color:#f92672">+</span> [self<span style="color:#f92672">.</span>_next() <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0x0f</span>)])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_next</span>(self):
</span></span><span style="display:flex;"><span>    self<span style="color:#f92672">.</span>state[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    buffer <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span> <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> self<span style="color:#f92672">.</span>count)]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(self<span style="color:#f92672">.</span>count):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>):
</span></span><span style="display:flex;"><span>            buffer[<span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> i <span style="color:#f92672">+</span> j] <span style="color:#f92672">=</span> (self<span style="color:#f92672">.</span>state[i] <span style="color:#f92672">&gt;&gt;</span> (<span style="color:#ae81ff">8</span><span style="color:#f92672">*</span>j)) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xff</span>
</span></span><span style="display:flex;"><span>    h <span style="color:#f92672">=</span> H(bytes(buffer))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> int(h[<span style="color:#ae81ff">2</span>:<span style="color:#ae81ff">4</span>]<span style="color:#f92672">.</span>hex(), <span style="color:#ae81ff">16</span>)
</span></span></code></pre></div><p>This concludes our Python implementation of WinRAR&rsquo;s PRNG!</p>
<h2 id="defining-the-curve-in-sagemath">Defining the curve in SageMath</h2>
<p>We are almost done but we need to put the pieces of the puzzle together. We need to start considering how we can define the Pegwit curve in SageMath.</p>
<p>For this purpose, we will focus on the files <code>ec_field.*</code> and <code>ec_param.*</code>. From <code>ec_param.h</code>, we see:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#elif GF_M == 255
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define GF_L	     15
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define GF_K	     17
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define GF_T	      3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define GF_RP	0x0003U
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define GF_TM0	      1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define GF_TM1	0x0001U
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define EC_B	0x00a1U
</span></span></span></code></pre></div><p>There is a comment on top of this file explaining what these magic numbers are:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">GF_M	dimension of the large finite field (GF_M = GF_L*GF_K)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">GF_L	dimension of the small finite field
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">GF_K	degree of the large field reduction trinomial
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">GF_T	intermediate power of the reduction trinomial
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">GF_RP	reduction polynomial for the small field (truncated)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span></code></pre></div><p>The smaller field is $GF(2^{15})$ and <code>GF_RP</code> tells us that it is defined over the polynomial $x + 1$ ($= 2^1 + 2^0 = 3$). However, to define it in SageMath, the irreducible polynomial must have degree $15$, so we use $x^{15} + x + 1$. Similarly, the large finite field is $GF(2^{17})$, which should be defined over the polynomial $y^{17} + y^3 + 1$. Notice that <code>GF_T</code> specifies the degree of the middle term.</p>
<p>Before defining the curve, I looked up the base point $G$ online and found it expressed in integer form:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>(<span style="color:#ae81ff">0x56fdcbc6a27acee0cc2996e0096ae74feb1acf220a2341b898b549440297b8cc</span>, <span style="color:#ae81ff">0x20da32e8afc90b7cf0e76bde44496b4d0794054e6ea60f388682463132f931a7</span>)
</span></span></code></pre></div><p>This is kinda weird though. Looking at the Pegwit source, $G$ is defined as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> ecPoint curve_point <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>	{<span style="color:#ae81ff">17U</span>, <span style="color:#ae81ff">0x38ccU</span>, <span style="color:#ae81ff">0x052fU</span>, <span style="color:#ae81ff">0x2510U</span>, <span style="color:#ae81ff">0x45aaU</span>, <span style="color:#ae81ff">0x1b89U</span>, <span style="color:#ae81ff">0x4468U</span>, <span style="color:#ae81ff">0x4882U</span>, <span style="color:#ae81ff">0x0d67U</span>, <span style="color:#ae81ff">0x4febU</span>, <span style="color:#ae81ff">0x55ceU</span>, <span style="color:#ae81ff">0x0025U</span>, <span style="color:#ae81ff">0x4cb7U</span>, <span style="color:#ae81ff">0x0cc2U</span>, <span style="color:#ae81ff">0x59dcU</span>, <span style="color:#ae81ff">0x289eU</span>, <span style="color:#ae81ff">0x65e3U</span>, <span style="color:#ae81ff">0x56fdU</span>, },
</span></span><span style="display:flex;"><span>	{<span style="color:#ae81ff">17U</span>, <span style="color:#ae81ff">0x31a7U</span>, <span style="color:#ae81ff">0x65f2U</span>, <span style="color:#ae81ff">0x18c4U</span>, <span style="color:#ae81ff">0x3412U</span>, <span style="color:#ae81ff">0x7388U</span>, <span style="color:#ae81ff">0x54c1U</span>, <span style="color:#ae81ff">0x539bU</span>, <span style="color:#ae81ff">0x4a02U</span>, <span style="color:#ae81ff">0x4d07U</span>, <span style="color:#ae81ff">0x12d6U</span>, <span style="color:#ae81ff">0x7911U</span>, <span style="color:#ae81ff">0x3b5eU</span>, <span style="color:#ae81ff">0x4f0eU</span>, <span style="color:#ae81ff">0x216fU</span>, <span style="color:#ae81ff">0x2bf2U</span>, <span style="color:#ae81ff">0x1974U</span>, <span style="color:#ae81ff">0x20daU</span>, },
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">/* curve_point */</span>
</span></span></code></pre></div><p>So, where did this integer come from?</p>
<h3 id="analyzing-the-pegwit-data-types">Analyzing the Pegwit data types</h3>
<p>What is this <code>ecPoint</code> type? Another struct&hellip; ? Let&rsquo;s take a look.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	gfPoint x, y;
</span></span><span style="display:flex;"><span>} ecPoint;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> lunit gfPoint [GF_POINT_UNITS];
</span></span></code></pre></div><p>So the coordinates of a curve point are &hellip; arrays again ? Oof&hellip; we encountered <code>vlPoint</code> previously too. What are the differences?</p>
<table>
  <thead>
      <tr>
          <th><code>vlPoint</code></th>
          <th><code>gfPoint</code></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Used to perform integer arithmetic operations in the prime  field $GF(n)$.</td>
          <td>Used to do curve point arithmetic. The coordinates of any point span the entire field $GF(15^{17})$.</td>
      </tr>
      <tr>
          <td>Represented as a list of fifteen 16-bit words.</td>
          <td>Represented as a list of seventeen 15-bit words.</td>
      </tr>
      <tr>
          <td>Max value : $2^{240} - 1$</td>
          <td>Max value : $2^{255} - 1$ (this is roughly true as field elements are polynomials; more on that later)</td>
      </tr>
  </tbody>
</table>
<p>Looking at <code>curve_point</code> above, one might notice that <code>ecPoint</code> is a list of seventeen 16-bit words but this is misleadingðŸ™‚.</p>
<p>It turns out that there are a couple methods for converting between the <code>gfPoint</code> and <code>vlPoint</code> types.</p>
<ul>
<li><code>gfPack</code> : Packs a field point into a <code>vlPoint</code> (compression required since a field point is larger)</li>
<li><code>gfUnpack</code> : Unpacks a <code>vlPoint</code> into a field point (undoes <code>gfPack</code>)</li>
</ul>
<p>There are also:</p>
<ul>
<li><code>ecPack</code> : Packs a curve point into a <code>vlPoint</code> (essentially a wrapper to <code>gfPack</code>)</li>
<li><code>ecUnpack</code> : Unpacks a <code>vlPoint</code> into a curve point (essentially a wrapper to <code>gfUnpack</code>)</li>
</ul>
<p>Let&rsquo;s look at <code>gfPack</code> briefly.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">gfPack</span>(<span style="color:#66d9ef">const</span> gfPoint p, vlPoint k)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">/* packs a field point into a vlPoint */</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> i;
</span></span><span style="display:flex;"><span>	vlPoint a;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">assert</span> (p <span style="color:#f92672">!=</span> NULL);
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">assert</span> (k <span style="color:#f92672">!=</span> NULL);
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">vlClear</span> (k); a[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> p[<span style="color:#ae81ff">0</span>]; i <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>; i<span style="color:#f92672">--</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">vlShortLshift</span> (k, <span style="color:#ae81ff">15</span>);
</span></span><span style="display:flex;"><span>		a[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> p[i];
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">vlAdd</span> (k, a);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>} <span style="color:#75715e">/* gfPack */</span>
</span></span></code></pre></div><p>As you might notice from <code>vlShortLshift</code>, it operates in groups of 15 bits. We will implement <code>gfPoint2Int</code> and <code>int2gfPoint</code> later, as doing so requires the curve to be defined first.</p>
<h3 id="first-try-failed">First try (failed)</h3>
<p>Initially, we (me and @macz) attempted to define the curve as follows and we were surprised to see that it worked like a charm.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>sage: F1<span style="color:#f92672">.&lt;</span>k<span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> GF(<span style="color:#ae81ff">2</span><span style="color:#f92672">^</span><span style="color:#ae81ff">15</span>, modulus<span style="color:#f92672">=</span>x<span style="color:#f92672">^</span><span style="color:#ae81ff">15</span><span style="color:#f92672">+</span>x<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>sage: F2<span style="color:#f92672">.&lt;</span>u<span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> F1<span style="color:#f92672">.</span>extension(x<span style="color:#f92672">^</span><span style="color:#ae81ff">17</span><span style="color:#f92672">+</span>x<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>sage: b <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xa1</span>
</span></span><span style="display:flex;"><span>sage: E <span style="color:#f92672">=</span> EllipticCurve(F2, [<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,F1<span style="color:#f92672">.</span>from_integer(b)])
</span></span></code></pre></div><p>&hellip; but there was a problem:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>sage: E<span style="color:#f92672">.</span>order()
</span></span><span style="display:flex;"><span><span style="color:#f92672">---------------------------------------------------------------------------</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">KeyError</span>                                  Traceback (most recent call last)
</span></span><span style="display:flex;"><span>File sage<span style="color:#f92672">/</span>structure<span style="color:#f92672">/</span>category_object<span style="color:#f92672">.</span>pyx:<span style="color:#ae81ff">857</span>, <span style="color:#f92672">in</span> sage<span style="color:#f92672">.</span>structure<span style="color:#f92672">.</span>category_object<span style="color:#f92672">.</span>CategoryObject<span style="color:#f92672">.</span>getattr_from_category()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">KeyError</span>: <span style="color:#e6db74">&#39;order&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>During handling of the above exception, another exception occurred:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">AttributeError</span>                            Traceback (most recent call last)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># redacted</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">AttributeError</span>: <span style="color:#e6db74">&#39;EllipticCurve_field_with_category&#39;</span> object has no attribute <span style="color:#e6db74">&#39;order&#39;</span>
</span></span></code></pre></div><p>Calling other methods, such as <code>E.random_point()</code>, leads to similar errors.</p>
<p>I was really not satisfied with this result, at all. I wanted to define the curve and be able to do all elliptic curve related thingies without errors. I knew it is possible to define it but I obviously had SageMath skill issue.</p>
<p>It was really a shame because we were even able to verify that $G$ is a point of the curve and do operations with it.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>Gi <span style="color:#f92672">=</span> (<span style="color:#ae81ff">0x56fdcbc6a27acee0cc2996e0096ae74feb1acf220a2341b898b549440297b8cc</span>, <span style="color:#ae81ff">0x20da32e8afc90b7cf0e76bde44496b4d0794054e6ea60f388682463132f931a7</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># next lines convert the integers to gf points</span>
</span></span><span style="display:flex;"><span>Gp <span style="color:#f92672">=</span> (Gi[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>digits(base<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span><span style="color:#f92672">^</span><span style="color:#ae81ff">15</span>), Gi[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>digits(base<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span><span style="color:#f92672">^</span><span style="color:#ae81ff">15</span>) )
</span></span><span style="display:flex;"><span>Gx <span style="color:#f92672">=</span> sum(F1<span style="color:#f92672">.</span>from_integer(a) <span style="color:#f92672">*</span> u<span style="color:#f92672">**</span>i <span style="color:#66d9ef">for</span> i, a <span style="color:#f92672">in</span> enumerate(Gp[<span style="color:#ae81ff">0</span>]))
</span></span><span style="display:flex;"><span>Gy <span style="color:#f92672">=</span> sum(F1<span style="color:#f92672">.</span>from_integer(a) <span style="color:#f92672">*</span> u<span style="color:#f92672">**</span>i <span style="color:#66d9ef">for</span> i, a <span style="color:#f92672">in</span> enumerate(Gp[<span style="color:#ae81ff">1</span>]))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">assert</span> E<span style="color:#f92672">.</span>is_on_curve(Gx, Gy)
</span></span></code></pre></div><h3 id="second-try">Second try</h3>
<p>To better understand this method, check my other post about <a href="https://rasti37.github.io/posts/2025-03-07-computing-inverse-ring-homomorphisms-diy/" target="_blank" rel="noopener">inverse ring homomorphisms</a>. Bibbidi bobbidi, the curve can be defined as follows without any errors:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>F1 <span style="color:#f92672">=</span> GF(<span style="color:#ae81ff">2</span><span style="color:#f92672">^</span><span style="color:#ae81ff">15</span>, modulus<span style="color:#f92672">=</span>[<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>], names<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;a&#39;</span>)
</span></span><span style="display:flex;"><span>R1 <span style="color:#f92672">=</span> PolynomialRing(F1, <span style="color:#e6db74">&#39;y&#39;</span>)
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">=</span> R1<span style="color:#f92672">.</span>gen()
</span></span><span style="display:flex;"><span>IP <span style="color:#f92672">=</span> y<span style="color:#f92672">^</span><span style="color:#ae81ff">17</span> <span style="color:#f92672">+</span> y<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Q <span style="color:#f92672">=</span> R1<span style="color:#f92672">.</span>quotient(IP)
</span></span><span style="display:flex;"><span>SF <span style="color:#f92672">=</span> IP<span style="color:#f92672">.</span>splitting_field(<span style="color:#e6db74">&#39;z&#39;</span>)
</span></span><span style="display:flex;"><span>b <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xa1</span>
</span></span><span style="display:flex;"><span>E <span style="color:#f92672">=</span> EllipticCurve(SF, [<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,F1<span style="color:#f92672">.</span>from_integer(b)])
</span></span></code></pre></div><p>We can verify this is the correct curve, since $n$ is a factor of the order:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>sage: factor(E<span style="color:#f92672">.</span>order())
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span><span style="color:#f92672">^</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">541</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1783611972232227286253403958852247502375646797202100661111162374777982257</span>
</span></span></code></pre></div><h3 id="final-boss">Final Boss</h3>
<p>Having setup the curve, we can now define <code>gfPoint2Int</code> and <code>int2gfPoint</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">int2gfPoint</span>(n):
</span></span><span style="display:flex;"><span>    packed <span style="color:#f92672">=</span> n<span style="color:#f92672">.</span>digits(base<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">15</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> sum(F1<span style="color:#f92672">.</span>from_integer(a) <span style="color:#f92672">*</span> Q<span style="color:#f92672">.</span>gen()<span style="color:#f92672">**</span>i <span style="color:#66d9ef">for</span> i, a <span style="color:#f92672">in</span> enumerate(packed))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gfPoint2Int</span>(p):
</span></span><span style="display:flex;"><span>    coeffs <span style="color:#f92672">=</span> list(p)
</span></span><span style="display:flex;"><span>    packed_coeffs <span style="color:#f92672">=</span> [c<span style="color:#f92672">.</span>to_integer() <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> coeffs]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> Integer(packed_coeffs, base<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">15</span>)
</span></span></code></pre></div><p>However, another problem arises:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>sage: Q <span style="color:#f92672">=</span> R1<span style="color:#f92672">.</span>quotient(IP)
</span></span><span style="display:flex;"><span>sage: Gi <span style="color:#f92672">=</span> (<span style="color:#ae81ff">0x56fdcbc6a27acee0cc2996e0096ae74feb1acf220a2341b898b549440297b8cc</span>, <span style="color:#ae81ff">0x20da32e8afc90b7cf0e76bde44496b4d0794054e6ea60f388682463132f931a7</span>)
</span></span><span style="display:flex;"><span>sage: Gx <span style="color:#f92672">=</span> int2gfPoint(Gi[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>sage: Gy <span style="color:#f92672">=</span> int2gfPoint(Gi[<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>sage: <span style="color:#66d9ef">assert</span> E<span style="color:#f92672">.</span>is_on_curve(Gx, Gy)
</span></span><span style="display:flex;"><span><span style="color:#f92672">---------------------------------------------------------------------------</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">TypeError</span>                                 Traceback (most recent call last)
</span></span><span style="display:flex;"><span><span style="color:#f92672">----&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">assert</span> E<span style="color:#f92672">.</span>is_on_curve(Gx, Gy)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># redacted</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">TypeError</span>: unsupported operand parent(s) <span style="color:#66d9ef">for</span> <span style="color:#f92672">*</span>: <span style="color:#e6db74">&#39;Finite Field in z of size 2^255&#39;</span> <span style="color:#f92672">and</span> <span style="color:#e6db74">&#39;Univariate Quotient Polynomial Ring in ybar over Finite Field in a of size 2^15 with modulus y^17 + y^3 + 1&#39;</span>
</span></span></code></pre></div><p>This is where it gets trickyðŸ˜µ.</p>
<p>Let&rsquo;s generate a random curve point and see what it looks like.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>sage: E<span style="color:#f92672">.</span>random_point()
</span></span><span style="display:flex;"><span>(z<span style="color:#f92672">^</span><span style="color:#ae81ff">253</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">252</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">251</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">250</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">249</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">248</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">247</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">246</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">245</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">242</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">241</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">239</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">238</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">237</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">236</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">231</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">230</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">225</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">223</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">222</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">218</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">216</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">215</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">213</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">212</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">211</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">209</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">208</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">206</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">205</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">203</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">200</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">199</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">198</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">196</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">195</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">192</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">188</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">182</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">181</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">178</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">175</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">174</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">172</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">170</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">169</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">166</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">165</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">164</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">163</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">162</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">161</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">160</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">159</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">157</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">155</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">153</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">152</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">150</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">145</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">144</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">143</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">142</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">139</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">138</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">135</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">134</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">129</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">127</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">125</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">123</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">119</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">117</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">115</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">113</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">111</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">110</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">109</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">108</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">105</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">101</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">98</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">97</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">94</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">93</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">92</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">91</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">90</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">89</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">84</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">83</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">82</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">79</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">78</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">77</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">74</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">71</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">70</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">68</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">67</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">63</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">62</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">61</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">60</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">59</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">58</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">50</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">48</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">44</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">42</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">38</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">37</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">36</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">35</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">34</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">31</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">30</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">28</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">23</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">17</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">15</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">14</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">11</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">9</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> : z<span style="color:#f92672">^</span><span style="color:#ae81ff">254</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">253</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">251</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">249</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">248</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">247</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">245</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">244</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">243</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">242</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">240</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">239</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">236</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">234</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">233</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">232</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">230</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">229</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">224</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">223</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">220</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">219</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">217</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">216</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">215</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">213</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">208</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">206</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">204</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">203</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">199</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">198</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">196</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">195</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">191</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">190</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">187</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">185</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">183</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">182</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">181</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">180</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">178</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">177</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">176</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">174</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">173</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">171</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">170</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">168</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">167</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">165</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">163</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">159</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">156</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">155</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">153</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">151</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">150</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">144</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">141</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">139</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">137</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">136</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">135</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">134</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">131</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">126</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">122</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">118</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">117</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">116</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">111</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">110</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">109</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">107</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">106</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">105</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">103</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">102</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">101</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">97</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">96</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">95</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">93</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">92</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">91</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">88</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">81</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">80</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">77</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">74</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">72</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">68</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">67</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">63</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">61</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">60</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">57</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">56</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">55</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">52</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">51</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">48</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">47</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">46</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">43</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">40</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">38</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">37</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">35</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">33</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">29</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">25</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">24</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">19</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">17</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">11</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> : <span style="color:#ae81ff">1</span>)
</span></span></code></pre></div><p>I thought we were dealing with the field $GF(15^{17})$, where each element is a degree-$17$ polynomial whose coefficients are themselves degree-$15$ polynomials. This is what the elements appear to look like â€” or at least, that&rsquo;s how $G$ looks after calling <code>int2gfPoint</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>sage: Gx
</span></span><span style="display:flex;"><span>(a<span style="color:#f92672">^</span><span style="color:#ae81ff">14</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">12</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">9</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">16</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">14</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">13</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> a <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">15</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">13</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">11</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> a)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">14</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">14</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">12</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">11</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">13</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">11</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span> a)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">12</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">14</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">11</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> a <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">11</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">14</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">12</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> a)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">9</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">14</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">11</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">9</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> a <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">11</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> a <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">14</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">11</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> a)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">14</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span>)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">12</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">11</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">9</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">14</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> a)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">13</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">4</span>)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> a <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>ybar <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">13</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">12</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">11</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>sage: Gy
</span></span><span style="display:flex;"><span>(a<span style="color:#f92672">^</span><span style="color:#ae81ff">13</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> a)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">16</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">12</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">11</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">15</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">13</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">11</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">9</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> a)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">14</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">13</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> a <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">13</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">14</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">11</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">9</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> a)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">12</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">13</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">12</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">11</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">9</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> a)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">11</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">14</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">13</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">12</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">11</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">12</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">9</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> a)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">9</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">14</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">11</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> a <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">14</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">11</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">9</span> <span style="color:#f92672">+</span> a)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">14</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">12</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">9</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> a <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">14</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">12</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">14</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">13</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">12</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">9</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span>)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">13</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">12</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> a)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">12</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">11</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">*</span>ybar<span style="color:#f92672">^</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> (a<span style="color:#f92672">^</span><span style="color:#ae81ff">14</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">13</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">6</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> a)<span style="color:#f92672">*</span>ybar <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">13</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">12</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> a<span style="color:#f92672">^</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> a <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span></code></pre></div><p>$G_x, G_y$ are polynomials in $\text{ybar}$ with the coefficients being polynomials in $a$ but the curve point coordinates are $255$-degree polynomials in $z$.</p>
<img src="reaction.gif" style="width:60%" />
<p>This is exactly when I realized that these two fields, i.e. $GF(2^{255})$ and $GF(15^{17})$, <em>MUST</em> be isomorphic and this is how the post about manual inverse homomorphisms was born. For more details, you can refer that <a href="https://rasti37.github.io/posts/2025-03-07-computing-inverse-ring-homomorphisms-diy/" target="_blank" rel="noopener">post</a>. For now, trust me bro, we need to slightly modify the implementations of <code>int2gfPoint</code> and <code>gfPoint2Int</code>. The former should apply the $f$ homomorphism, and the latter should apply its inverse $f^{-1}$:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>IP <span style="color:#f92672">=</span> y<span style="color:#f92672">**</span><span style="color:#ae81ff">17</span> <span style="color:#f92672">+</span> y<span style="color:#f92672">**</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>domain <span style="color:#f92672">=</span> R1<span style="color:#f92672">.</span>quotient(IP)
</span></span><span style="display:flex;"><span>codomain <span style="color:#f92672">=</span> IP<span style="color:#f92672">.</span>splitting_field(<span style="color:#e6db74">&#39;z&#39;</span>)
</span></span><span style="display:flex;"><span>y_ <span style="color:#f92672">=</span> IP<span style="color:#f92672">.</span>change_ring(codomain)<span style="color:#f92672">.</span>any_root()
</span></span><span style="display:flex;"><span>f <span style="color:#f92672">=</span> domain<span style="color:#f92672">.</span>hom([y_], GF(<span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">255</span>, <span style="color:#e6db74">&#39;z&#39;</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e"># for the implementation of `find_inverse_homomorphism`, check my other post.</span>
</span></span><span style="display:flex;"><span>finv <span style="color:#f92672">=</span> find_inverse_homomorphism(f)
</span></span></code></pre></div><p>Recall that the homomorphisms $f, f^{-1}$ are defined as:</p>
<p>$$f : \textbf{F}_{1}[y] \ / \ (y^{17} + y^3 + 1) \rightarrow \textbf{F}_{2^{255}} \\ f^{-1} : \textbf{F}_{2^{255}} \rightarrow \textbf{F}_{1}[y] \ / \ (y^{17} + y^3 + 1)$$</p>
<p>where:</p>
<p>$$\textbf{F}_{1} = \textbf{F}_{2}[a]\ / \ (a^{15} + a + 1)$$</p>
<p>Finally, we need to modify <code>int2gfPoint</code> and <code>gfPoint2Int</code> accordingly:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">int2gfPoint</span>(n):
</span></span><span style="display:flex;"><span>    packed <span style="color:#f92672">=</span> n<span style="color:#f92672">.</span>digits(base<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">15</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> f(sum(F1<span style="color:#f92672">.</span>from_integer(a) <span style="color:#f92672">*</span> domain<span style="color:#f92672">.</span>gen()<span style="color:#f92672">**</span>i <span style="color:#66d9ef">for</span> i, a <span style="color:#f92672">in</span> enumerate(packed)))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gfPoint2Int</span>(p):
</span></span><span style="display:flex;"><span>    coeffs <span style="color:#f92672">=</span> list(finv(p))
</span></span><span style="display:flex;"><span>    packed_coeffs <span style="color:#f92672">=</span> [c<span style="color:#f92672">.</span>to_integer() <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> coeffs]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> Integer(packed_coeffs, base<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">15</span>)
</span></span></code></pre></div><p>AAAND &hellip; FINALLY:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>sage: Gi <span style="color:#f92672">=</span> (<span style="color:#ae81ff">0x56fdcbc6a27acee0cc2996e0096ae74feb1acf220a2341b898b549440297b8cc</span>, <span style="color:#ae81ff">0x20da32e8afc90b7cf0e76bde44496b4d0794054e6ea60f388682463132f931a7</span>)
</span></span><span style="display:flex;"><span>sage: Gx <span style="color:#f92672">=</span> int2gfPoint(Gi[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>sage: Gy <span style="color:#f92672">=</span> int2gfPoint(Gi[<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>sage: <span style="color:#66d9ef">assert</span> E<span style="color:#f92672">.</span>is_on_curve(Gx, Gy)
</span></span><span style="display:flex;"><span>sage: Gx
</span></span><span style="display:flex;"><span>z<span style="color:#f92672">^</span><span style="color:#ae81ff">254</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">247</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">245</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">242</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">240</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">239</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">235</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">234</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">233</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">231</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">230</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">229</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">226</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">225</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">224</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">222</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">220</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">219</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">216</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">213</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">209</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">208</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">204</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">203</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">202</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">201</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">200</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">199</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">198</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">195</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">194</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">193</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">191</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">189</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">188</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">187</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">183</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">181</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">178</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">177</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">176</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">175</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">174</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">173</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">172</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">171</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">170</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">169</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">168</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">165</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">161</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">159</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">157</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">154</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">152</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">151</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">150</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">149</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">148</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">144</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">141</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">139</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">137</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">135</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">133</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">132</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">131</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">130</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">128</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">127</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">126</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">121</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">118</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">116</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">110</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">109</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">108</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">107</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">106</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">104</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">102</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">101</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">100</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">99</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">95</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">92</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">90</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">88</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">84</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">78</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">76</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">75</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">73</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">72</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">71</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">69</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">68</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">67</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">63</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">62</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">61</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">56</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">52</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">49</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">48</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">45</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">43</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">42</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">41</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">36</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">33</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">32</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">31</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">30</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">28</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">24</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">23</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">22</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">20</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">18</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">16</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">14</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">13</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">12</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">7</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span></code></pre></div><h2 id="implementation-sanity-check">Implementation Sanity Check</h2>
<p>I have grabbed a valid signature from WinRAR (via debugging) for the seed <code>336606507e63ec734eb7b6f75bd6be1230aa223f0d3dc42c06</code> and the data <code>r4sti7a4305372c7833238fdea689fd4c85e7a58864a691b3d2071e795feb60222311</code>:</p>
<pre tabindex="0"><code>(0x0dbc977ee85e88a1379778a5461676e6b48818e95accc458a4f70488d85c, 0x67bd89ef91e0b03f90f73331d4bc649dbd14fe05a099616ade42a3b2a6c3)
</code></pre><p>Now, let&rsquo;s run the signature scheme and verify that we get the same signature:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> scheme <span style="color:#f92672">import</span> NybergRueppelScheme
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>seed <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;336606507e63ec734eb7b6f75bd6be1230aa223f0d3dc42c06&#39;</span>
</span></span><span style="display:flex;"><span>scheme <span style="color:#f92672">=</span> NybergRueppelScheme(seed)
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;r4sti7a4305372c7833238fdea689fd4c85e7a58864a691b3d2071e795feb60222311&#39;</span>
</span></span><span style="display:flex;"><span>r, s <span style="color:#f92672">=</span> scheme<span style="color:#f92672">.</span>sign(data)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">assert</span> (r, s) <span style="color:#f92672">==</span> (<span style="color:#ae81ff">0x0dbc977ee85e88a1379778a5461676e6b48818e95accc458a4f70488d85c</span>, <span style="color:#ae81ff">0x67bd89ef91e0b03f90f73331d4bc649dbd14fe05a099616ade42a3b2a6c3</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;[+] thanks for reading :-)&#39;</span>)
</span></span></code></pre></div><p>Output:</p>
<pre tabindex="0"><code>[+] thanks for reading :-)
</code></pre><h1 id="bonus">BONUS</h1>
<p>After writing the post about inverse homomorphism computation, I decided to make a <a href="https://github.com/sagemath/sage/pull/39709" target="_blank" rel="noopener">pull request</a> to SageMath to add this missing feature and I was really happy that they accepted itðŸ˜„. Extra kudos to @grhkm for his advice and suggestions for improvementðŸŽ‰.</p>
<p>You can find my SageMath commit <a href="https://github.com/sagemath/sage/commit/11ae3b1047af25849676a1073d8a938c1ea3db9f" target="_blank" rel="noopener">here</a> and the full Python implementation on my GitHub <a href="https://github.com/rasti37/WinRAR-Signature-Scheme-SageMath-Implementation" target="_blank" rel="noopener">repository</a>.</p>
<p>If you want to chat about anything, my Discord handle is <code>r4sti</code>, cya!</p>

		</div>
	</article>
</main>
<aside>
	<div>
		<div>
			<h3>RELATED POSTS</h3>
		</div>
		<div>
			<ul>
				
				<li>2025-04-18 :: <a href="/posts/2025-04-18-a-deep-dive-into-donex-ransomware-part-2/">A Deep Dive Into Donex Ransomware [Part 2]</a></li>
				
				<li>2025-04-08 :: <a href="/posts/2025-04-08-a-deep-dive-into-donex-ransomware-part-1/">A Deep Dive into Donex Ransomware [Part 1]</a></li>
				
				<li>2025-03-07 :: <a href="/posts/2025-03-07-computing-inverse-ring-homomorphisms-diy/">Computing Inverse Ring Homomorphisms (DIY)</a></li>
				
			</ul>
		</div>
	</div>
</aside>


	<footer>
	<p>&copy; 2025 :: <a href="http://localhost:1313/"
			class='header-footer-anchor'><b>rasti&#39;s knowledge cave</b></a> Â·
		
		<a href="https://github.com/rasti37" class='header-footer-anchor' target='_blank'><b>Github</b></a>
	</p>
</footer>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css"
  integrity="sha384-zh0CIslj+VczCZtlzBcjt5ppRcsAmDnRem7ESsYwWwg3m/OaJ2l4x7YBZl9Kxxib" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js"
  integrity="sha384-Rma6DA2IPUwhNxmrB/7S3Tno0YY7sFu9WSYMCuulLhIqYSGZ2gKCJWIqhBWqMQfh" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js"
  integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" crossorigin="anonymous"
  onload="renderMathInElement(document.body);"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    renderMathInElement(document.body, {
      delimiters: [
        { left: '$$', right: '$$', display: true }, 
        { left: '$', right: '$', display: false }, 
        { left: '\\(', right: '\\)', display: false }, 
        { left: '\\[', right: '\\]', display: true }, 
      ],
      throwOnError: false
    });
  });
</script>

</body>
</html>
